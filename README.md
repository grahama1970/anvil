# Anvil

<p align="center">
  <img src="anvil.png" alt="Anvil logo" width="400" />
</p>

A **no-vibes** debugging and hardening harness:

- **`anvil debug`**: issue-like prompt ➜ context ➜ repro plan ➜ multi-track worktrees ➜ verify ➜ judge ➜ apply
- **`anvil harden`**: red-team a repo or a candidate patch (break it, find inefficiencies/risks, add tests)

The project is designed to be **imported via `file:///`** into other repos (Sparta, extractor, memory) and run
either from a human terminal or by an orchestrator agent.

## Documentation

- [**Quickstart Guide**](QUICKSTART.md): Get up and runnning in 5 minutes.
- [**Contributing Guide**](CONTRIBUTING.md): How to develop and extend Anvil.
- [**System Contract**](docs/CONTRACT.md): The "No Vibes" guarantee.

## Installation

```bash
# Clone and install
git clone https://github.com/google-deepmind/anvil.git
cd anvil
pip install -e .
```

For detailed usage, see the [Quickstart Guide](QUICKSTART.md).

**Docker mode available**: Use `--docker` flag for containerized verify execution (see [Quickstart](QUICKSTART.md#docker-mode-recommended-for-isolation)).

## “No vibes” enforcement

A track is **DISQUALIFIED** if it:

- violates a contract (missing/invalid required artifacts, schema drift),
- claims work without artifacts,
- or fails to run required `check` gates.

See: `AGENTS.md` and the `CONTRACT` docstrings in each step.

## Providers / Agents

Providers are pluggable:

- `manual` provider: generates iteration templates (works offline)
- `gh_cli` provider: uses the GitHub CLI (`gh`) as a backend transport (optional)
- `copilot` provider: uses GitHub Copilot CLI (`copilot --model ... -p ...`)
- `gemini` provider: uses Gemini CLI (`gemini --model ... --prompt ...`)

You can configure tracks in `.dbg/tracks.yaml` (generated by `dbg init`).
This is where you can mix-and-match models/providers per track based on where they excel.

Example:

```yaml
tracks:
  - name: A
    role: backend_fixer
    provider: copilot
    model: claude-sonnet-4.5
  - name: B
    role: explorer
    provider: gemini
    model: gemini-3-pro
```

## Tree-sitter utilities (optional)

If installed (`uv add anvil[treesitter]`), the context builder can optionally emit symbol outlines for relevant files (fallback/partial support only; see below for full support):

- `SYMBOLS.json` (symbols with ranges)

Enable via `--use-treesitter` or config (`context.use_treesitter: true`).

### Local `treesitter-tools` integration (this workspace)

For full support (recommended), this repo also defines an optional `ast` dependency group that installs `treesitter-tools` from `file:///home/graham/workspace/experiments/treesitter-tools`.

```bash
uv sync --group ast
```

## Commands

### Debug

- `anvil debug run ...`
- `anvil debug status --run <id>`
- `anvil debug resume --run <id>`

### Harden

- `anvil harden run ...`
- `anvil harden status --run <id>`

### Utilities

- `anvil init` (writes `.dbg/` templates in the target repo)
- `anvil doctor` (checks git, docker, provider auth, verify commands)

Both `anvil` and `dbg` commands work (legacy alias supported).
