# debugger

A **no-vibes** debugging and hardening harness:

- **`dbg debug`**: issue-like prompt ➜ context ➜ repro plan ➜ multi-track worktrees ➜ verify ➜ judge ➜ apply
- **`dbg harden`**: red-team a repo or a candidate patch (break it, find inefficiencies/risks, add tests)

The project is designed to be **imported via `file:///`** into other repos (Sparta, extractor, memory) and run
either from a human terminal or by an orchestrator agent.

## Quickstart (this repo)

```bash
uv venv --python=3.11.12 .venv
uv sync
uv run dbg --help
```

## Quickstart (use inside another repo)

From your target repo (must be a git repo):

```bash
uv add --editable /ABS/PATH/TO/debugger
uv run dbg init
uv run dbg debug run --issue "Title: Example\n\nBody:\nSteps...\nExpected...\nActual..."
```

Or:

```bash
uv run dbg debug run --issue-file issue.md
```

Artifacts are written under `.dbg/runs/<run_id>/`.

## “No vibes” enforcement

A track is **DISQUALIFIED** if it:
- violates a contract (missing/invalid required artifacts, schema drift),
- claims work without artifacts,
- or fails to run required `check` gates.

See: `AGENTS.md` and the `CONTRACT` docstrings in each step.

## Providers / Agents

Providers are pluggable:

- `manual` provider: generates iteration templates (works offline)
- `gh_cli` provider: uses the GitHub CLI (`gh`) as a backend transport (optional)
- `copilot` provider: uses GitHub Copilot CLI (`copilot --model ... -p ...`)
- `gemini` provider: uses Gemini CLI (`gemini --model ... --prompt ...`)

You can configure tracks in `.dbg/tracks.yaml` (generated by `dbg init`).
This is where you can mix-and-match models/providers per track based on where they excel.

Example:

```yaml
tracks:
  - name: A
    role: backend_fixer
    provider: copilot
    model: claude-sonnet-4.5
  - name: B
    role: explorer
    provider: gemini
    model: gemini-3-pro
```

## Tree-sitter utilities (optional)

If installed (`uv add debugger[treesitter]`), the context builder can optionally emit symbol outlines
for relevant files:

- `SYMBOLS.json` (symbols with ranges)

Enable via `--use-treesitter` or config (`context.use_treesitter: true`).

### Local `treesitter-tools` integration (this workspace)

This repo also defines an optional `ast` dependency group that installs
`treesitter-tools` from `file:///home/graham/workspace/experiments/treesitter-tools`.

```bash
uv sync --group ast
```

## Commands

### Debug

- `dbg debug run ...`
- `dbg debug status --run <id>`
- `dbg debug resume --run <id>`

### Harden

- `dbg harden run ...`
- `dbg harden status --run <id>`

### Utilities

- `dbg init` (writes `.dbg/` templates in the target repo)
- `dbg doctor` (checks git, docker, provider auth, verify commands)
